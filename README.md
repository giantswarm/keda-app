[![CircleCI](https://circleci.com/gh/giantswarm/keda-app.svg?style=shield)](https://circleci.com/gh/giantswarm/keda-app)

# keda chart

Giant Swarm offers a keda App which can be installed in workload clusters.

## Installing

There are several ways to install this app onto a workload cluster.

- [Using our web interface](https://docs.giantswarm.io/ui-api/web/app-platform/#installing-an-app).
- By creating an [App resource](https://docs.giantswarm.io/ui-api/management-api/crd/apps.application.giantswarm.io/) in the management cluster as explained in [Getting started with App Platform](https://docs.giantswarm.io/app-platform/getting-started/).

## Upgrading keda version

The content of the `helm` folder are being generated by the `make` target called `make update-chart`.

This target uses [`vendir`](https://carvel.dev/vendir/) to fetch the helm chart contained in [the fork of the keda repository that we maintain](https://github.com/giantswarm/keda-upstream).
Currently, the state is the following:
- the `release/2.17` branch on the fork contains latest upstream release `v2.17.x`, with our custom changes on top released in keda-app 3.x which is compatible with kubernetes 1.30 up to v1.32.
- the `release/2.15` branch on the fork contains latest upstream release `v2.15.x`, with our custom changes on top released in keda-app 2.x which is compatible with kubernetes 1.28 up to v1.30.

If you want to upgrade this keda-app to use a newer version of keda, you need to prepare our fork first.

In `keda-upstream`, you need to:

```bash
git remote add upstream git@github.com:kedacore/charts.git
git fetch --tags upstream main

git checkout main
git rebase --interactive upstream/main
<Change TODO so all commits but the first get squashed into the first>
<Fix merge conflicts>
<Name the squashed commit something like "Giant Swarm changes.">

git checkout -b release/v2.18
git reset --hard v2.18.<latest patch>
git cherry-pick <Giant Swarm changes commit>
helm-docs
git push origin release/v2.18
```

In `keda-app`:

- Update the branch in `vendir.yaml`
- Run the make target `APPLICATION=keda make update-chart && helm-docs helm/keda`
- Update schema: `helm schema-gen helm/keda/values.yaml > helm/keda/values.schema.json`
- Create a new pull request in `keda-app` with the generated changes.
If you need further customizations, you can keep adding commits on the new `keda-upstream` branch, and re-run `APPLICATION=keda make update-chart && helm-docs helm/keda` to update the generated files.
Do not forget to review this README.
- Merge the changes in `keda-app` once you're happy with the changes and you've tested it works in a workload cluster.
- Release a new major version of our `keda app`
